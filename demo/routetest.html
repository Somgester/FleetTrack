<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vehicle Tracking</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  </head>
  <body>
    <div id="leafletMap" style="height: 800px"></div>

    <link
      data-require="leaflet@0.7.7"
      data-semver="0.7.7"
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.0/leaflet.css"
    />
    <script
      data-require="leaflet@0.7.7"
      data-semver="0.7.7"
      src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.0/leaflet.js"
    ></script>
    <script src="https://npmcdn.com/leaflet-geometryutil"></script>
    <script>
      // Leaflet with OpenStreetMap
      var leafletMap = L.map("leafletMap").setView([23.204424, 80.062008], 20);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: "Â© OpenStreetMap contributors",
      }).addTo(leafletMap);

      var leafletRouteCoordinates = [
        [23.204424, 80.062008],
        [23.204414, 80.061476],
        [23.204414, 80.061333],
        [23.204391, 80.06042],
        [23.204363, 80.059267],
        [23.204355, 80.05836],
        [23.20436, 80.058095],
        [23.204362, 80.057768],
        [23.204372, 80.057138],
        [23.204368, 80.056948],
        [23.204362, 80.056668],
        [23.204281, 80.056058],
        [23.204114, 80.055089],
        [23.203938, 80.054449],
        [23.203815, 80.054059],
        [23.203457, 80.052972],
        [23.203131, 80.05191],
        [23.203073, 80.051678],
        [23.203044, 80.051496],
        [23.203021, 80.051164],
        [23.203042, 80.050309],
        [23.203047, 80.050101],
        [23.203081, 80.048998],
        [23.203125, 80.048488],
        [23.203156, 80.048189],
        [23.203307, 80.046761],
        [23.203579, 80.044544],
        [23.20376, 80.042868],
        [23.203888, 80.041925],
        [23.203908, 80.041721],
        [23.203925, 80.041535],
        [23.204039, 80.040349],
        [23.204009, 80.039809],
        [23.203913, 80.039411],
        [23.203294, 80.038014],
        [23.203165, 80.037656],
        [23.202989, 80.037411],
        [23.201889, 80.036481],
        [23.201142, 80.035842],
        [23.200982, 80.035671],
        [23.199943, 80.034432],
        [23.199225, 80.033543],
        [23.199134, 80.033409],
        [23.199056, 80.033256],
        [23.199003, 80.03306],
        [23.198948, 80.032738],
        [23.198826, 80.031144],
        [23.198448, 80.024626],
        [23.198135, 80.019183],
        [23.198017, 80.017255],
        [23.198012, 80.016956],
        [23.19803, 80.016759],
        [23.19808, 80.016603],
        [23.198153, 80.016527],
        [23.198373, 80.016393],
        [23.199442, 80.015875],
        [23.199505, 80.015834],
        [23.199542, 80.015774],
        [23.19956, 80.015708],
        [23.199567, 80.015469],
        [23.199508, 80.014783],
        [23.199479, 80.014269],
        [23.199452, 80.013553],
        [23.199422, 80.013191],
        [23.199319, 80.012466],
        [23.199119, 80.011411],
        [23.198987, 80.010748],
        [23.198542, 80.008439],
        [23.198174, 80.00704],
        [23.19803, 80.006481],
        [23.197967, 80.006136],
        [23.197929, 80.005855],
        [23.197894, 80.005729],
        [23.197729, 80.004051],
        [23.197629, 80.003394],
        [23.197482, 80.00257],
        [23.19738, 80.002196],
        [23.196769, 80.000656],
        [23.195662, 79.997976],
        [23.195222, 79.996775],
        [23.195117, 79.996491],
        [23.194892, 79.995875],
        [23.194732, 79.995434],
        [23.194551, 79.994929],
        [23.193942, 79.993339],
        [23.193845, 79.993129],
        [23.193121, 79.991855],
        [23.192958, 79.99155],
        [23.192545, 79.990672],
        [23.192028, 79.989598],
        [23.191681, 79.988896],
        [23.190753, 79.987105],
        [23.190546, 79.986712],
        [23.190159, 79.985962],
        [23.189445, 79.98459],
        [23.189191, 79.984181],
        [23.188311, 79.982773],
        [23.18829, 79.982703],
        [23.18827, 79.982671],
        [23.187755, 79.981835],
        [23.187221, 79.980969],
        [23.186653, 79.980048],
        [23.186533, 79.979857],
        [23.185722, 79.978557],
        [23.185389, 79.977994],
        [23.185004, 79.977343],
        [23.18462, 79.976676],
        [23.183995, 79.975733],
        [23.183223, 79.974678],
        [23.181882, 79.972818],
        [23.181611, 79.972462],
        [23.181518, 79.972332],
        [23.18149, 79.972221],
        [23.181495, 79.972115],
        [23.181578, 79.971668],
        [23.181782, 79.970773],
        [23.181796, 79.970648],
        [23.181809, 79.970484],
        [23.181803, 79.970317],
        [23.181751, 79.969997],
        [23.181654, 79.96968],
        [23.181539, 79.969301],
        [23.181205, 79.967956],
        [23.181053, 79.967321],
        [23.180988, 79.967062],
        [23.180619, 79.965833],
        [23.180559, 79.965588],
        [23.180471, 79.965027],
        [23.18034, 79.964404],
        [23.180272, 79.964158],
        [23.180214, 79.964061],
        [23.180189, 79.96399],
        [23.17985, 79.963052],
        [23.179689, 79.962674],
        [23.179495, 79.962217],
        [23.179188, 79.961392],
        [23.179174, 79.961294],
        [23.179154, 79.961274],
        [23.179146, 79.961236],
        [23.178563, 79.960662],
        [23.17822, 79.960386],
        [23.177566, 79.960045],
        [23.177362, 79.959971],
        [23.177132, 79.959916],
        [23.176599, 79.959786],
        [23.175814, 79.959625],
        [23.175732, 79.959585],
        [23.175698, 79.959539],
        [23.175669, 79.959438],
        [23.17562, 79.958891],
        [23.17557, 79.958783],
        [23.175494, 79.958724],
        [23.17507, 79.958583],
        [23.174781, 79.958499],
        [23.174043, 79.958259],
        [23.173922, 79.958238],
        [23.17384, 79.958231],
        [23.173611, 79.95828],
        [23.172944, 79.958465],
        [23.172101, 79.958601],
        [23.171592, 79.958658],
        [23.171194, 79.958603],
        [23.17075, 79.958492],
        [23.170578, 79.958437],
        [23.170456, 79.958383],
        [23.170361, 79.958322],
        [23.170267, 79.95824],
        [23.170187, 79.958098],
        [23.169678, 79.957058],
        [23.169618, 79.956967],
        [23.169493, 79.956872],
        [23.169406, 79.956832],
        [23.169235, 79.956753],
        [23.169073, 79.956714],
        [23.168475, 79.956794],
        [23.16822, 79.956824],
        [23.168101, 79.956778],
        [23.168059, 79.956727],
        [23.167675, 79.955873],
        [23.167142, 79.954753],
        [23.167104, 79.954684],
        [23.167577, 79.954159],
        [23.167734, 79.95394],
        [23.167874, 79.953692],
        [23.168037, 79.953355],
        [23.168129, 79.953077],
        [23.168164, 79.952674],
        [23.16814, 79.951452],
        [23.168144, 79.95116],
        [23.168123, 79.95084],
        [23.168042, 79.95053],
        [23.167975, 79.95048],
        [23.167948, 79.950438],
        [23.167583, 79.950093],
        [23.167534, 79.950018],
        [23.167479, 79.94992],
        [23.16732, 79.949563],
        [23.167235, 79.949319],
        [23.167134, 79.948965],
        [23.167082, 79.948719],
        [23.167077, 79.948567],
        [23.167097, 79.948422],
        [23.167319, 79.947237],
        [23.167406, 79.946748],
        [23.167392, 79.946597],
        [23.167398, 79.946223],
        [23.167373, 79.946201],
        [23.167354, 79.946172],
        [23.167342, 79.946103],
        [23.167366, 79.946038],
        [23.16739, 79.946014],
        [23.167588, 79.945588],
        [23.16768, 79.945329],
        [23.167867, 79.944677],
        [23.168076, 79.943958],
        [23.168263, 79.943414],
        [23.169372, 79.940156],
        [23.169357, 79.940092],
        [23.169381, 79.940032],
        [23.169434, 79.940001],
        [23.169493, 79.940012],
        [23.169729, 79.939867],
        [23.170007, 79.939656],
        [23.17014, 79.939509],
        [23.170254, 79.939337],
        [23.17044, 79.938994],
      ];

      var leafletRoute = L.polyline(leafletRouteCoordinates, {
        color: "blue",
      }).addTo(leafletMap);

      var leafletVehicleMarker = L.marker([23.204424, 80.062008]).addTo(
        leafletMap
      );

      var currentIndex = 0;

      setInterval(function () {
        var newLocation = getLatestVehicleLocation();
        leafletVehicleMarker.setLatLng(newLocation);

        var deviation = calculateDeviation(
          newLocation,
          leafletRouteCoordinates
        );
        console.log("Leaflet Deviation:", deviation);
      }, 1000);

      function calculateDeviation(vehicleLocation, routeCoordinates) {
        var latlng = L.latLng(vehicleLocation.lat, vehicleLocation.lng);
        var closestPoint = L.GeometryUtil.closest(
          leafletMap,
          routeCoordinates,
          latlng,
          false
        );
        //_distance = L.GeometryUtil.distance(_map, _firstLatLng, _secondLatLng);
        var distance = L.GeometryUtil.distance(
          leafletMap,
          latlng,
          closestPoint
        );
        return distance;
      }

      function getLatestVehicleLocation() {
        // This can be done via AJAX, WebSockets, or any other suitable method
        var currentCoordinate = leafletRouteCoordinates[currentIndex];

        currentIndex = (currentIndex + 1) % leafletRouteCoordinates.length;
        random1 = Math.random() * 0.0001;
        random2 = Math.random() * 0.0001;
        return {
          lat: currentCoordinate[0] + random1,
          lng: currentCoordinate[1] + random2,
        };
      }
    </script>
  </body>
</html>
